<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cantillan, R. | Bucca, M.">
<meta name="dcterms.date" content="2024-08-20">

<title>Ejercicio2: Tidyverse y Tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="custom.scss">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Ejercicio2: Tidyverse y Tidyr</h1>
            <p class="subtitle lead">Una aplicación de análisis de Redes de Comercio Internacional</p>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Cantillan, R. | Bucca, M. </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              ISUC
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">20 August 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En este ejercicio</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a>
  <ul class="collapse">
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos"><span class="header-section-number">1.1</span> Datos</a></li>
  </ul></li>
  <li><a href="#carga-de-librerías-y-datos" id="toc-carga-de-librerías-y-datos" class="nav-link" data-scroll-target="#carga-de-librerías-y-datos"><span class="header-section-number">2</span> Carga de librerías y datos</a></li>
  <li><a href="#ejercicio-1-análisis-de-densidad-de-red" id="toc-ejercicio-1-análisis-de-densidad-de-red" class="nav-link" data-scroll-target="#ejercicio-1-análisis-de-densidad-de-red"><span class="header-section-number">3</span> Ejercicio 1: Análisis de densidad de red</a></li>
  <li><a href="#ejercicio-2-medidas-de-centralidad" id="toc-ejercicio-2-medidas-de-centralidad" class="nav-link" data-scroll-target="#ejercicio-2-medidas-de-centralidad"><span class="header-section-number">4</span> Ejercicio 2: Medidas de centralidad</a></li>
  <li><a href="#ejercicio-3-análisis-de-red-ponderada" id="toc-ejercicio-3-análisis-de-red-ponderada" class="nav-link" data-scroll-target="#ejercicio-3-análisis-de-red-ponderada"><span class="header-section-number">5</span> Ejercicio 3: Análisis de red ponderada</a></li>
  <li><a href="#ejercicio-4-algoritmo-pagerank" id="toc-ejercicio-4-algoritmo-pagerank" class="nav-link" data-scroll-target="#ejercicio-4-algoritmo-pagerank"><span class="header-section-number">6</span> Ejercicio 4: Algoritmo <code>PageRank</code></a></li>
  <li><a href="#análisis-de-comunidades" id="toc-análisis-de-comunidades" class="nav-link" data-scroll-target="#análisis-de-comunidades"><span class="header-section-number">7</span> Análisis de comunidades</a>
  <ul class="collapse">
  <li><a href="#network-plots-extra." id="toc-network-plots-extra." class="nav-link" data-scroll-target="#network-plots-extra."><span class="header-section-number">7.1</span> Network plots (EXTRA).</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introducción" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introducción"><span class="header-section-number">1</span> Introducción</h2>
<p>Este análisis se basa en el estudio de Luca De Benedictis y Lucia Tajoli (2011) sobre “La Red Mundial de Comercio” y utiliza datos del Proyecto “Correlates of War”. Exploraremos cómo el comercio internacional ha evolucionado a lo largo del tiempo, utilizando técnicas de análisis de redes y las herramientas proporcionadas por Tidyverse y Tidyr.</p>
<section id="datos" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="datos"><span class="header-section-number">1.1</span> Datos</h3>
<p>Los datos se encuentran en el archivo <code>trade.csv</code> y contienen la siguiente información:</p>
<ul>
<li><code>country1</code>: Nombre del país exportador</li>
<li><code>country2</code>: Nombre del país importador</li>
<li><code>year</code>: Año</li>
<li><code>exports</code>: Valor total de las exportaciones (en decenas de millones de dólares)</li>
</ul>
<p>Los datos cubren los años 1900, 1920, 1940, 1955, 1980, 2000 y 2009.</p>
</section>
</section>
<section id="carga-de-librerías-y-datos" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="carga-de-librerías-y-datos"><span class="header-section-number">2</span> Carga de librerías y datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages( "printr",  type = 'source',  repos = c('http://yihui.name/xran', 'http://cran.rstudio.com'))</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(printr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalluvial)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(trade, <span class="at">package =</span> <span class="st">"qss"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trade)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">.row</th>
<th style="text-align: left;">country1</th>
<th style="text-align: left;">country2</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">exports</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Haiti</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Dominican Republic</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Mexico</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">17.08</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Guatemala</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Honduras</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">El Salvador</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dicotomizamos la red (en formato edgelist)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Iniciamos una cadena de operaciones sobre el dataframe 'trade'</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># El resultado final se asignará de vuelta a 'trade'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>trade <span class="ot">&lt;-</span> trade <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleccionamos todas las columnas excepto '.row'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># El signo menos (-) indica que estamos excluyendo esta columna</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">.row</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modificamos la columna 'exports':</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reemplazamos todos los valores NA en 'exports' con 0</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Esto se hace usando la función replace_na()</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Si hay otros valores en 'exports', se mantienen sin cambios</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exports =</span> <span class="fu">replace_na</span>(exports, <span class="dv">0</span>))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trade)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country1</th>
<th style="text-align: left;">country2</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">exports</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Haiti</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Dominican Republic</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Mexico</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">17.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Guatemala</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">Honduras</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">United States of America</td>
<td style="text-align: left;">El Salvador</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="ejercicio-1-análisis-de-densidad-de-red" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="ejercicio-1-análisis-de-densidad-de-red"><span class="header-section-number">3</span> Ejercicio 1: Análisis de densidad de red</h2>
<p>Analizaremos el comercio internacional como una red no ponderada y dirigida. Crearemos una matriz de adyacencia donde <span class="math inline">\((i,j)\)</span> es 1 si el país <span class="math inline">\(i\)</span> exporta al país <span class="math inline">\(j\)</span>, y 0 en caso contrario.</p>
<p>La densidad de la red se define como:</p>
<p><span class="math display">\[
\text{densidad de la red} = \frac{\text{número de aristas}}{\text{número de aristas potenciales}}
\]</span></p>
<p>En el ejericio siguiente:</p>
<ul>
<li>Identificamos todos los años únicos en los datos.</li>
<li>Preparamos la estructura de datos para almacenar resultados (densidades y matrices de adyacencia).</li>
<li>Para cada año:
<ul>
<li>Filtra los datos relevantes.</li>
<li>Crea una matriz de aristas (conexiones entre países).</li>
<li>Convierte esta matriz en un objeto de grafo.</li>
<li>Almacena el grafo.</li>
<li>Calcula y almacena la densidad del grafo.</li>
</ul></li>
</ul>
<p>El resultado final es una lista de grafos (adj.mat) y un vector de densidades (densities), uno para cada año en los datos.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Matrices de Adyacencia
</div>
</div>
<div class="callout-body-container callout-body">
<p>Una matriz de adyacencia es una representación matemática de un grafo o red. En esta matriz, las filas y columnas representan los nodos (o vértices) del grafo, y los valores en la matriz indican si existe una conexión (arista) entre dos nodos.</p>
<p>Características principales:</p>
<ol type="1">
<li>Es una matriz cuadrada (mismo número de filas y columnas).</li>
<li>Para un grafo no dirigido, la matriz es simétrica.</li>
<li>Los elementos de la diagonal principal suelen ser cero (a menos que se permitan bucles).</li>
<li>Para grafos ponderados, los valores pueden representar el peso de las conexiones.</li>
</ol>
<p>Ejemplo:</p>
<p>Consideremos un grafo simple con 3 nodos (A, B, C) y las siguientes conexiones:</p>
<ul>
<li>A está conectado con B</li>
<li>B está conectado con C</li>
<li>C está conectado con A</li>
</ul>
<p>La matriz de adyacencia para este grafo sería:</p>
<pre><code>   A  B  C
A  0  1  1
B  1  0  1
C  1  1  0</code></pre>
<p>En R, podríamos representar esta matriz así:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>matriz_adj <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(matriz_adj) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(matriz_adj) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(matriz_adj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Esta representación es útil para realizar cálculos y análisis sobre la estructura de la red.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
El Loop: Procesamiento de Datos en Serie
</div>
</div>
<div class="callout-body-container callout-body">
<p>Imagina un loop como una línea de producción para procesar datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for (registro in base_de_datos) {</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   dato_limpio &lt;- limpiar_dato(registro)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   dato_analizado &lt;- analizar_dato(dato_limpio)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   almacenar_resultado(dato_analizado)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Funcionamiento del Loop:</p>
<ul>
<li>base_de_datos es tu conjunto de datos a procesar.</li>
<li>Cada registro es un elemento individual de la base de datos.</li>
<li>El loop procesa cada registro de forma secuencial.</li>
<li>Aplica las mismas operaciones (limpiar, analizar, almacenar) a cada registro.</li>
<li>Continúa hasta procesar todos los registros de la base de datos.</li>
</ul>
<p>Este método es eficiente para aplicar un conjunto de operaciones a múltiples elementos de datos de manera sistemática.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos todos los años únicos del conjunto de datos 'trade' y los guarda en 'years'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(trade<span class="sc">$</span>year)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea un vector 'densities' lleno de NA's, con la misma longitud que 'years'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>densities <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(years))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicializa una lista vacía llamada 'adj.mat' para almacenar las matrices de adyacencia</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>adj.mat <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicia un bucle que se ejecutará para cada año en 'years'</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(years)){</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtra los datos de 'trade' para el año actual y exportaciones positivas,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># selecciona solo los países exportador e importador, y convierte a matriz</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  temp_edges <span class="ot">&lt;-</span> trade <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> years[i], exports <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country1, country2) <span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crea un objeto de grafo dirigido a partir de la matriz de aristas</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  temp_adj <span class="ot">&lt;-</span> <span class="fu">graph_from_edgelist</span>(temp_edges, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guarda el grafo en la lista 'adj.mat' en la posición correspondiente al año actual</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  adj.mat[[i]] <span class="ot">&lt;-</span> temp_adj</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcula la densidad del grafo y la guarda en 'densities' en la posición del año actual</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  densities[i] <span class="ot">&lt;-</span> <span class="fu">graph.density</span>(temp_adj)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># nombres</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(adj.mat) <span class="ot">&lt;-</span> years</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># trasnformamos a tibble</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> years, <span class="at">density =</span> densities)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ploteamos la distirbución </span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de la Red de Comercio Internacional"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Interpretación</strong>: La densidad de la red de comercio internacional ha aumentado generalmente desde 1900 hasta 2009, lo que indica una creciente interconexión global. Sin embargo, se observa una caída notable alrededor de 1940, probablemente debido a las políticas proteccionistas y los efectos de la Segunda Guerra Mundial.</p>
</section>
<section id="ejercicio-2-medidas-de-centralidad" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="ejercicio-2-medidas-de-centralidad"><span class="header-section-number">4</span> Ejercicio 2: Medidas de centralidad</h2>
<p>Calcularemos las medidas de centralidad basadas en grado, intermediación y cercanía para los años 1900, 1955 y 2009.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
La Función: Módulo de Análisis Reutilizable
</div>
</div>
<div class="callout-body-container callout-body">
<p>Considera una función como un módulo de análisis especializado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  analizar_tendencias &lt;- function(datos, periodo, variable) {</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    datos_filtrados &lt;- filtrar_por_periodo(datos, periodo)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    tendencia &lt;- calcular_tendencia(datos_filtrados, variable)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    grafico &lt;- generar_grafico(tendencia)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    return(list(tendencia = tendencia, grafico = grafico))</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    }</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Estructura y Lógica de la Función:</p>
<ul>
<li><code>analizar_tendencias</code> es el nombre de tu módulo de análisis.</li>
<li><code>datos</code>, <code>periodo</code>, y <code>variable</code> son los parámetros de entrada.</li>
<li>La función ejecuta una serie de pasos analíticos predefinidos.</li>
<li>Procesa los datos de entrada según los parámetros especificados.</li>
<li>Retorna resultados estructurados (en este caso, una lista con la tendencia y un gráfico).</li>
<li>Se puede reutilizar para diferentes conjuntos de datos: <code>analizar_tendencias(datos_ventas, "2023", "ingresos")</code></li>
<li>Esta estructura permite crear componentes de análisis modulares y reutilizables, lo cual mejora la eficiencia y consistencia.</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos una función que calcula las medidas de centralidad para un año dado</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>calculate_centralities <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtiene el grafo correspondiente al año desde la lista adj.mat</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> adj.mat[[<span class="fu">as.character</span>(year)]]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crea un tibble con el país y sus medidas de centralidad</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">country =</span> <span class="fu">names</span>(<span class="fu">V</span>(graph)),  <span class="co"># Nombres de los nodos (países)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">degree =</span> <span class="fu">degree</span>(graph),     <span class="co"># Grado de centralidad</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">betweenness =</span> <span class="fu">betweenness</span>(graph),  <span class="co"># Intermediación</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">closeness =</span> <span class="fu">closeness</span>(graph, <span class="at">mode =</span> <span class="st">"all"</span>)  <span class="co"># Cercanía</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> year)  <span class="co"># Añade el año como columna</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplica la función a los años 1900, 1955 y 2009, combinando los resultados en un único dataframe</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>centralities <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="dv">1900</span>, <span class="dv">1955</span>, <span class="dv">2009</span>), calculate_centralities)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Muestra los 5 países con mayor grado de centralidad para cada año</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>centralities <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> degree) <span class="sc">%&gt;%</span>  <span class="co"># Selecciona los top 5 por grado</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, degree, betweenness, closeness) <span class="sc">%&gt;%</span>        <span class="co"># Selecciona solo estas columnas</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="fu">desc</span>(degree)) <span class="sc">%&gt;%</span>          <span class="co"># Ordena por año y grado descendente</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Top 5 países por grado de centralidad"</span>)  <span class="co"># Crea una tabla bonita</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Top 5 países por grado de centralidad</caption>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">country</th>
<th style="text-align: right;">degree</th>
<th style="text-align: right;">betweenness</th>
<th style="text-align: right;">closeness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">419.45519</td>
<td style="text-align: right;">0.0270270</td>
</tr>
<tr class="even">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">133.10400</td>
<td style="text-align: right;">0.0238095</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">60.04964</td>
<td style="text-align: right;">0.0217391</td>
</tr>
<tr class="even">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">63.79488</td>
<td style="text-align: right;">0.0222222</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">37.43019</td>
<td style="text-align: right;">0.0204082</td>
</tr>
<tr class="even">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">296.91710</td>
<td style="text-align: right;">0.0123457</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">German Federal Republic</td>
<td style="text-align: right;">147</td>
<td style="text-align: right;">210.47082</td>
<td style="text-align: right;">0.0121951</td>
</tr>
<tr class="even">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: right;">146</td>
<td style="text-align: right;">138.47309</td>
<td style="text-align: right;">0.0121951</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">Italy</td>
<td style="text-align: right;">146</td>
<td style="text-align: right;">244.81575</td>
<td style="text-align: right;">0.0121951</td>
</tr>
<tr class="even">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">145</td>
<td style="text-align: right;">153.91901</td>
<td style="text-align: right;">0.0120482</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">363</td>
<td style="text-align: right;">440.36355</td>
<td style="text-align: right;">0.0052083</td>
</tr>
<tr class="even">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">China</td>
<td style="text-align: right;">363</td>
<td style="text-align: right;">461.00904</td>
<td style="text-align: right;">0.0052356</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">India</td>
<td style="text-align: right;">362</td>
<td style="text-align: right;">462.69186</td>
<td style="text-align: right;">0.0052356</td>
</tr>
<tr class="even">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">521.24579</td>
<td style="text-align: right;">0.0052083</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">414.56138</td>
<td style="text-align: right;">0.0052083</td>
</tr>
<tr class="even">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">Japan</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">473.51765</td>
<td style="text-align: right;">0.0052083</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Interpretación</strong>: En los primeros períodos, los países occidentales (por ejemplo, Reino Unido, Alemania, Estados Unidos) tendían a dominar la red de comercio internacional en términos de centralidad. Para 2009, los cinco países principales se habían diversificado significativamente, con China e India ocupando posiciones destacadas.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
La función <code>map_dfr</code> de purrr
</div>
</div>
<div class="callout-body-container callout-body">
<p>La función <code>map_dfr</code> es parte de la familia de funciones <code>map</code> en el paquete purrr de R. Esta función es particularmente útil cuando se trabaja con listas o vectores y se desea aplicar una función a cada elemento, devolviendo los resultados como un único data frame.</p>
<p>Características principales:</p>
<ol type="1">
<li><strong>Aplicación de función</strong>: Aplica una función dada a cada elemento de una lista o vector.</li>
<li><strong>Combinación de resultados</strong>: Une los resultados de cada aplicación de la función en un único data frame.</li>
<li><strong>Preservación de filas</strong>: El sufijo ’_dfr’ indica que los resultados se combinan por filas (row-binding).</li>
</ol>
<p>Sintaxis básica:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(.x, .f, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Donde: - <code>.x</code> es la lista o vector de entrada - <code>.f</code> es la función a aplicar - <code>...</code> son argumentos adicionales pasados a la función</p>
<p><code>map_dfr</code> es especialmente útil en análisis de datos cuando se necesita aplicar la misma operación a múltiples conjuntos de datos y combinar los resultados en un único data frame para su posterior análisis o visualización.</p>
</div>
</div>
</section>
<section id="ejercicio-3-análisis-de-red-ponderada" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="ejercicio-3-análisis-de-red-ponderada"><span class="header-section-number">5</span> Ejercicio 3: Análisis de red ponderada</h2>
<p>Ahora analizaremos la red de comercio como una red ponderada y dirigida, donde el peso de cada arista es proporcional al volumen de comercio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos una función para calcular centralidades ponderadas para un año específico</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>calculate_weighted_centralities <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtramos los datos para el año especificado, seleccionando solo conexiones con exportaciones &gt; 0</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  edges <span class="ot">&lt;-</span> trade <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="sc">!!</span>year, exports <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country1, country2, <span class="at">weight =</span> exports)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos un grafo dirigido a partir de los datos filtrados</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(edges, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculamos las medidas de centralidad y las organizamos en un tibble</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">country =</span> <span class="fu">names</span>(<span class="fu">V</span>(graph)),  <span class="co"># Nombres de los países (nodos)</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">strength =</span> <span class="fu">strength</span>(graph), <span class="co"># Fuerza (grado ponderado)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">betweenness =</span> <span class="fu">betweenness</span>(graph, <span class="at">weights =</span> <span class="fu">E</span>(graph)<span class="sc">$</span>weight), <span class="co"># Intermediación ponderada</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">closeness =</span> <span class="fu">closeness</span>(graph, <span class="at">mode =</span> <span class="st">"all"</span>, <span class="at">weights =</span> <span class="fu">E</span>(graph)<span class="sc">$</span>weight) <span class="co"># Cercanía ponderada</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> year) <span class="co"># Añadimos el año como columna</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicamos la función a los años 1900, 1955 y 2009</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>weighted_centralities <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="dv">1900</span>, <span class="dv">1955</span>, <span class="dv">2009</span>), calculate_weighted_centralities)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostramos los 5 países con mayor fuerza de centralidad para cada año</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>weighted_centralities <span class="sc">%&gt;%</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> strength) <span class="sc">%&gt;%</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, strength, betweenness, closeness) <span class="sc">%&gt;%</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="fu">desc</span>(strength)) <span class="sc">%&gt;%</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Top 5 países por fuerza de centralidad (red ponderada)"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Top 5 países por fuerza de centralidad (red ponderada)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">country</th>
<th style="text-align: right;">strength</th>
<th style="text-align: right;">betweenness</th>
<th style="text-align: right;">closeness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">2836.4000</td>
<td style="text-align: right;">311.000000</td>
<td style="text-align: right;">0.0391651</td>
</tr>
<tr class="even">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">2081.9900</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.0314140</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">1857.0103</td>
<td style="text-align: right;">184.000000</td>
<td style="text-align: right;">0.0438884</td>
</tr>
<tr class="even">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">1242.0400</td>
<td style="text-align: right;">44.000000</td>
<td style="text-align: right;">0.0255090</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1900</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">750.0987</td>
<td style="text-align: right;">300.000000</td>
<td style="text-align: right;">0.0439504</td>
</tr>
<tr class="even">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">26285.5229</td>
<td style="text-align: right;">87.333333</td>
<td style="text-align: right;">0.0440882</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">15852.2630</td>
<td style="text-align: right;">78.000000</td>
<td style="text-align: right;">0.0461879</td>
</tr>
<tr class="even">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">German Federal Republic</td>
<td style="text-align: right;">11387.9900</td>
<td style="text-align: right;">78.000000</td>
<td style="text-align: right;">0.0379170</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">Canada</td>
<td style="text-align: right;">9845.7020</td>
<td style="text-align: right;">119.333333</td>
<td style="text-align: right;">0.0580142</td>
</tr>
<tr class="even">
<td style="text-align: right;">1955</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">6418.7470</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.0549100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">2550432.7900</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.0001485</td>
</tr>
<tr class="even">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">China</td>
<td style="text-align: right;">2441328.3500</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.0001489</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">Japan</td>
<td style="text-align: right;">1182584.7600</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.0001489</td>
</tr>
<tr class="even">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">867601.3080</td>
<td style="text-align: right;">187.379081</td>
<td style="text-align: right;">0.0001489</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">733534.1520</td>
<td style="text-align: right;">7.349355</td>
<td style="text-align: right;">0.0001489</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Interpretación</strong>: Las medidas de centralidad para las redes ponderadas producen resultados sustancialmente diferentes de los de las redes no ponderadas. En particular, asignan puntuaciones altas de centralidad de intermediación y cercanía a países que no tienen grandes economías. Esto sugiere que, aunque estos países pueden no comerciar en grandes cantidades, conectan a otros grandes socios comerciales que de otro modo estarían distantemente conectados.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Grafos Dirigidos y su Representación Matricial
</div>
</div>
<div class="callout-body-container callout-body">
<p>Un grafo dirigido es una estructura matemática que representa relaciones direccionales entre objetos.</p>
<p>Características principales:</p>
<ol type="1">
<li><strong>Nodos (o vértices)</strong>: Representan los objetos o entidades.</li>
<li><strong>Aristas (o enlaces) dirigidos</strong>: Conectan los nodos y tienen una dirección específica.</li>
</ol>
<section id="representación-matricial" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="representación-matricial"><span class="header-section-number">5.1</span> Representación Matricial</h3>
<p>Un grafo dirigido puede representarse mediante una matriz de adyacencia:</p>
<ul>
<li>Es una matriz cuadrada de tamaño <span class="math inline">\(n \times n\)</span>, donde <span class="math inline">\(n\)</span> es el número de nodos.</li>
<li>El elemento <span class="math inline">\(a_{ij}\)</span> de la matriz es 1 si hay una arista del nodo <span class="math inline">\(i\)</span> al nodo <span class="math inline">\(j\)</span>, y 0 en caso contrario.</li>
</ul>
<p>Algebraicamente, para un grafo <span class="math inline">\(G\)</span> con <span class="math inline">\(n\)</span> nodos, su matriz de adyacencia <span class="math inline">\(A\)</span> se define como:</p>
<p><span class="math display">\[
A = [a_{ij}] \quad \text{donde} \quad a_{ij} = \begin{cases}
1 &amp; \text{si hay una arista de } i \text{ a } j \\
0 &amp; \text{en caso contrario}
\end{cases}
\]</span></p>
</section>
<section id="ejemplo-con-r" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="ejemplo-con-r"><span class="header-section-number">5.2</span> Ejemplo con R</h3>
<p>Consideremos un pequeño grafo dirigido que representa el comercio entre 4 países:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir las aristas del grafo</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">2</span>,  <span class="co"># País 1 exporta al País 2</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">3</span>,  <span class="co"># País 1 exporta al País 3</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">3</span>,  <span class="co"># País 2 exporta al País 3</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">4</span>   <span class="co"># País 3 exporta al País 4</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el grafo</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_edgelist</span>(edges, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la matriz de adyacencia</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>adj_matrix <span class="ot">&lt;-</span> <span class="fu">as_adjacency_matrix</span>(g)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la matriz de adyacencia</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(adj_matrix)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar el grafo</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g, <span class="at">edge.arrow.size =</span> <span class="fl">0.5</span>, <span class="at">vertex.label =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
</div>
</section>
<section id="ejercicio-4-algoritmo-pagerank" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="ejercicio-4-algoritmo-pagerank"><span class="header-section-number">6</span> Ejercicio 4: Algoritmo <code>PageRank</code></h2>
<p>Aplicaremos el algoritmo <code>PageRank</code> a la red de comercio ponderada para cada año.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Algoritmo PageRank
</div>
</div>
<div class="callout-body-container callout-body">
<p>El algoritmo <code>PageRank</code>, desarrollado por Larry Page y Sergey Brin en 1996, es un método para medir la importancia de los nodos en una red dirigida. Originalmente diseñado para clasificar páginas web en los resultados de búsqueda de Google, <code>PageRank</code> tiene aplicaciones en diversos tipos de redes, incluidas las redes de comercio internacional.</p>
<p>Definición formal:</p>
<p>Para un grafo dirigido <span class="math inline">\(G\)</span> con n nodos, el PageRank <span class="math inline">\(PR(u)\)</span> de un nodo u se define como: <span class="math display">\[PR(u) = \frac{1-d}{n} + d \sum_{v \in B_u} \frac{PR(v)}{L(v)}\]</span></p>
<p>Donde:</p>
<p><span class="math inline">\(d\)</span> es un factor de amortiguación (típicamente 0.85) <span class="math inline">\(B_u\)</span> es el conjunto de nodos que apuntan a u <span class="math inline">\(L(v)\)</span> es el número de enlaces salientes desde el nodo v</p>
<p>En términos sustantivos, PageRank asigna una puntuación a cada nodo basándose en la estructura de enlaces de la red. Un nodo tiene un PageRank alto si:</p>
<ul>
<li>Muchos otros nodos apuntan a él (tiene muchos enlaces entrantes)</li>
<li>Los nodos que apuntan a él también tienen un PageRank alto</li>
</ul>
<p>En el contexto de redes de comercio internacional, un país con un alto PageRank sería uno que:</p>
<ul>
<li>Recibe exportaciones de muchos otros países</li>
<li>Recibe exportaciones de países que a su vez son importantes en la red de comercio</li>
</ul>
<p>Referencia:</p>
<p>Page, L., Brin, S., Motwani, R., &amp; Winograd, T. (1999). The PageRank citation ranking: Bringing order to the web. Stanford InfoLab.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos una función para calcular PageRank para un año específico</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>calculate_pagerank <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtramos los datos para el año especificado</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleccionamos solo las conexiones con exportaciones positivas</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Renombramos 'exports' a 'weight' para usar en el grafo</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  edges <span class="ot">&lt;-</span> trade <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="sc">!!</span>year, exports <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country1, country2, <span class="at">weight =</span> exports)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos un grafo dirigido a partir de los datos filtrados</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(edges, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculamos PageRank y creamos un tibble con los resultados</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">country =</span> <span class="fu">names</span>(<span class="fu">V</span>(graph)),  <span class="co"># Nombres de los países (nodos del grafo)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pagerank =</span> <span class="fu">page_rank</span>(graph)<span class="sc">$</span>vector  <span class="co"># Valores de PageRank para cada país</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> year)  <span class="co"># Añadimos el año como columna</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
El operador de “unquoting” <code>!!</code> en rlang
</div>
</div>
<div class="callout-body-container callout-body">
<p>En la expresión <code>year == !!year</code>:</p>
<ul>
<li><code>year</code> (el primer <code>year</code>) se refiere a la columna ‘year’ en el dataframe.</li>
<li><code>!!year</code> (el segundo <code>year</code>) se refiere al argumento <code>year</code> de la función que contiene esta expresión.</li>
</ul>
<p>El <code>!!</code> es un operador de “unquoting” en rlang, el lenguaje de metaprogramación de tidyverse. Su función es crucial en la programación con dplyr:</p>
<ol type="1">
<li><p><strong>Propósito</strong>: Le indica a R que debe evaluar <code>year</code> en el entorno de la función, no en el dataframe.</p></li>
<li><p><strong>Funcionamiento</strong>: “Desenvuelve” la variable <code>year</code>, insertando su valor en la expresión.</p></li>
<li><p><strong>Necesidad</strong>: Sin <code>!!</code>, R buscaría una columna llamada <code>year</code> en el dataframe, lo cual no es lo deseado en este contexto.</p></li>
<li><p><strong>Uso en programación</strong>: Permite crear funciones más flexibles que pueden trabajar con diferentes valores de variables.</p></li>
</ol>
<p>Ejemplo:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>filter_by_year <span class="ot">&lt;-</span> <span class="cf">function</span>(data, year_val) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="sc">!!</span>year_val)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Aquí, <code>!!year_val</code> asegura que se use el valor pasado a <code>year_val</code>, no una columna llamada <code>year_val</code>.</p>
<p>Este operador es parte de la “programación no estándar” que hace que tidyverse sea poderoso y flexible para el análisis de datos.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicamos la función a los años 1900, 1955 y 2009</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># map_dfr aplica la función a cada año y combina los resultados en un único dataframe</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>pagerank_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="dv">1900</span>, <span class="dv">1955</span>, <span class="dv">2009</span>), calculate_pagerank)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostramos los 5 países con mayor PageRank para cada año</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>pagerank_results <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span>  <span class="co"># Agrupamos por año</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> pagerank) <span class="sc">%&gt;%</span>  <span class="co"># Seleccionamos los top 5 por PageRank</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="fu">desc</span>(pagerank)) <span class="sc">%&gt;%</span>  <span class="co"># Ordenamos por año y PageRank descendente</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Top 5 países por PageRank"</span>)  <span class="co"># Creamos una tabla formateada</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizamos la evolución del PageRank para países seleccionados</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>pagerank_results <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtramos para incluir solo los países especificados</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"United States of America"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Russia"</span>, <span class="st">"Japan"</span>, <span class="st">"China"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos un gráfico de líneas</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> pagerank, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>  <span class="co"># Añadimos líneas</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co"># Añadimos puntos para cada observación</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolución del PageRank para países seleccionados"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"PageRank"</span>) <span class="sc">+</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># Aplicamos un tema minimalista al gráfico</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Top 5 países por PageRank</caption>
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">pagerank</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">0.2148234</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">0.1241042</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">0.1036946</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">France</td>
<td style="text-align: right;">0.0737686</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">0.0474671</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">0.1192706</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">0.0981821</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">German Federal Republic</td>
<td style="text-align: right;">0.0619836</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Russia</td>
<td style="text-align: right;">0.0436273</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Canada</td>
<td style="text-align: right;">0.0414142</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">0.1166511</td>
<td style="text-align: right;">2009</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">0.0828028</td>
<td style="text-align: right;">2009</td>
</tr>
<tr class="odd">
<td style="text-align: left;">France</td>
<td style="text-align: right;">0.0405142</td>
<td style="text-align: right;">2009</td>
</tr>
<tr class="even">
<td style="text-align: left;">Japan</td>
<td style="text-align: right;">0.0380871</td>
<td style="text-align: right;">2009</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">0.0356402</td>
<td style="text-align: right;">2009</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Interpretación</strong>: Estados Unidos ha tenido el PageRank más alto desde 1940. Antes de eso, el Reino Unido era el más influyente según el algoritmo PageRank. En los últimos años, las clasificaciones de Japón y luego de China han aumentado según los valores de PageRank, mientras que las clasificaciones de países como el Reino Unido y Rusia han disminuido.</p>
</section>
<section id="análisis-de-comunidades" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="análisis-de-comunidades"><span class="header-section-number">7</span> Análisis de comunidades</h2>
<p>Utilizaremos el algoritmo de detección de comunidades de Louvain para identificar grupos de países que comercian más entre sí.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>detect_communities <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  edges <span class="ot">&lt;-</span> trade <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="sc">!!</span>year, exports <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country1, country2, <span class="at">weight =</span> exports)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(edges, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  undirected_graph <span class="ot">&lt;-</span> <span class="fu">as.undirected</span>(graph, <span class="at">mode =</span> <span class="st">"collapse"</span>, <span class="at">edge.attr.comb =</span> <span class="fu">list</span>(<span class="at">weight =</span> <span class="st">"sum"</span>))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  communities <span class="ot">&lt;-</span> <span class="fu">cluster_louvain</span>(undirected_graph)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">country =</span> <span class="fu">names</span>(<span class="fu">V</span>(undirected_graph)),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">community =</span> communities<span class="sc">$</span>membership</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> year)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>community_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="dv">1900</span>, <span class="dv">1955</span>, <span class="dv">2009</span>), detect_communities)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(community_results, <span class="at">n=</span><span class="dv">50</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>community_results <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, community) <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> count, <span class="at">fill =</span> <span class="fu">factor</span>(community))) <span class="sc">+</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución de países en comunidades comerciales"</span>,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"Número de países"</span>, <span class="at">fill =</span> <span class="st">"Comunidad"</span>) <span class="sc">+</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">community</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Haiti</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dominican Republic</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mexico</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colombia</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Venezuela</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ecuador</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peru</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bolivia</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chile</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Argentina</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Uruguay</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Netherlands</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">France</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Switzerland</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spain</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Austria-Hungary</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Italy</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yugoslavia</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Greece</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Romania</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Russia</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sweden</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Denmark</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Morocco</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Iran</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Turkey</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Korea</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Japan</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">Thailand</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United States of America</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Canada</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cuba</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Haiti</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dominican Republic</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mexico</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Guatemala</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Honduras</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">El Salvador</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nicaragua</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Costa Rica</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Panama</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colombia</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Venezuela</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1955</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>alluvial_data <span class="ot">&lt;-</span> community_results <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, community) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.factor</span>(year))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular el total de países por año para los porcentajes</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>total_by_year <span class="ot">&lt;-</span> alluvial_data <span class="sc">%&gt;%</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(count))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>alluvial_data <span class="ot">&lt;-</span> alluvial_data <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(total_by_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> count <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(alluvial_data)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">year</th>
<th style="text-align: right;">community</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">total</th>
<th style="text-align: right;">percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1900</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">61.111111</td>
</tr>
<tr class="even">
<td style="text-align: left;">1900</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">30.555556</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1900</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">8.333333</td>
</tr>
<tr class="even">
<td style="text-align: left;">1955</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">37.500000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1955</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">13.750000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1955</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">33.750000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(alluvial_data,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> count, <span class="at">alluvium =</span> community, <span class="at">stratum =</span> community)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flow</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(community)), <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">curve_type =</span> <span class="st">"quintic"</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stratum</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(community)), <span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"stratum"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)), </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolución de las Comunidades Comerciales"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Distribución y tamaño de las comunidades a lo largo del tiempo"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Año"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Número de Países"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Comunidad"</span>) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">20</span>)),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">20</span>, <span class="at">b =</span> <span class="dv">20</span>, <span class="at">l =</span> <span class="dv">20</span>, <span class="at">unit =</span> <span class="st">"pt"</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Interpretación</strong>: Este análisis nos permite identificar comunidades de países que tienden a comerciar más entre sí. Observando cómo estas comunidades cambian a lo largo del tiempo, podemos inferir cambios en los patrones globales de comercio, como la formación de bloques comerciales regionales o el surgimiento de nuevos centros de comercio global.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Intuición Teórica y Sociológica del Algoritmo de Detección de Comunidades
</div>
</div>
<div class="callout-body-container callout-body">
<p>El algoritmo de <code>Louvain</code>, utilizado en este código para detectar comunidades, se basa en la optimización de la modularidad de la red. La modularidad es una medida que cuantifica la calidad de una división de la red en comunidades.</p>
<p>Formalmente, la modularidad Q se define como: <span class="math display">\[Q = \frac{1}{2m} \sum_{ij} \left[A_{ij} - \frac{k_i k_j}{2m}\right] \delta(c_i, c_j)\]</span> Donde:</p>
<ul>
<li><span class="math inline">\(A_{ij}\)</span> es el peso de la arista entre los nodos i y j</li>
<li><span class="math inline">\(k_i\)</span> y <span class="math inline">\(k_j\)</span> son las sumas de los pesos de las aristas adjuntas a los nodos i y j respectivamente</li>
<li><span class="math inline">\(m\)</span> es la suma de todos los pesos de las aristas en la red</li>
<li><span class="math inline">\(c_i\)</span> y <span class="math inline">\(c_j\)</span> son las comunidades de los nodos i y j</li>
<li><span class="math inline">\(\delta(c_i, c_j)\)</span> es 1 si <span class="math inline">\(c_i = c_j\)</span> y 0 en caso contrario</li>
</ul>
<p>Intuitivamente, el algoritmo busca grupos de nodos que están más densamente conectados entre sí que con el resto de la red. En el contexto de redes de comercio internacional:</p>
<ol type="1">
<li><p><strong>Bloques comerciales</strong>: Las comunidades detectadas pueden representar bloques comerciales o regiones económicas donde los países tienen relaciones comerciales más intensas entre sí.</p></li>
<li><p><strong>Globalización vs.&nbsp;Regionalización</strong>: La evolución de estas comunidades a lo largo del tiempo puede reflejar tendencias hacia la globalización (menos comunidades, más interconectadas) o la regionalización (comunidades más definidas y separadas).</p></li>
<li><p><strong>Asimetrías en el comercio global</strong>: La estructura de las comunidades puede revelar asimetrías en el sistema de comercio global, identificando grupos de países centrales y periféricos.</p></li>
<li><p><strong>Impacto de políticas comerciales</strong>: Cambios en la estructura de las comunidades pueden reflejar el impacto de acuerdos comerciales, uniones aduaneras o cambios en las políticas económicas globales.</p></li>
<li><p><strong>Resiliencia económica</strong>: La estructura de las comunidades puede ofrecer insights sobre la resiliencia de diferentes regiones económicas frente a shocks globales.</p></li>
</ol>
</div>
</div>
<section id="network-plots-extra." class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="network-plots-extra."><span class="header-section-number">7.1</span> Network plots (EXTRA).</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Definición de la función para detectar comunidades en un año específico</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>detect_communities <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar los datos para el año específico y seleccionar columnas relevantes</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  edges <span class="ot">&lt;-</span> trade <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="sc">!!</span>year, exports <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country1, country2, <span class="at">weight =</span> exports)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un grafo dirigido a partir de los datos filtrados</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(edges, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir el grafo dirigido en no dirigido, sumando los pesos de las aristas</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  undirected_graph <span class="ot">&lt;-</span> <span class="fu">as.undirected</span>(graph, <span class="at">mode =</span> <span class="st">"collapse"</span>, <span class="at">edge.attr.comb =</span> <span class="fu">list</span>(<span class="at">weight =</span> <span class="st">"sum"</span>))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Detectar comunidades utilizando el algoritmo de Louvain</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  communities <span class="ot">&lt;-</span> <span class="fu">cluster_louvain</span>(undirected_graph)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Devolver una lista con el grafo no dirigido y las comunidades detectadas</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph =</span> undirected_graph,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">communities =</span> communities</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Definición de la función para crear y optimizar el plot de comunidades</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>plot_community_optimized <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Detectar comunidades para el año especificado</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">detect_communities</span>(year)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> result<span class="sc">$</span>graph</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  communities <span class="ot">&lt;-</span> result<span class="sc">$</span>communities</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un layout inicial utilizando el algoritmo Fruchterman-Reingold</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  layout_initial <span class="ot">&lt;-</span> <span class="fu">layout_with_fr</span>(graph)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Función para calcular el centro de una comunidad</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  community_center <span class="ot">&lt;-</span> <span class="cf">function</span>(comm) {</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    members <span class="ot">&lt;-</span> <span class="fu">which</span>(communities<span class="sc">$</span>membership <span class="sc">==</span> comm)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colMeans</span>(layout_initial[members,, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular los centros de todas las comunidades</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  comm_centers <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">unique</span>(communities<span class="sc">$</span>membership), community_center)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar el layout para agrupar nodos por comunidad</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  layout_adjusted <span class="ot">&lt;-</span> layout_initial</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (comm <span class="cf">in</span> <span class="fu">unique</span>(communities<span class="sc">$</span>membership)) {</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    members <span class="ot">&lt;-</span> <span class="fu">which</span>(communities<span class="sc">$</span>membership <span class="sc">==</span> comm)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    center <span class="ot">&lt;-</span> comm_centers[,comm]</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mover los nodos hacia el centro de su comunidad (70% hacia el centro, 30% posición original)</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    layout_adjusted[members,] <span class="ot">&lt;-</span> layout_initial[members,, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> </span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(center, <span class="at">nrow =</span> <span class="fu">length</span>(members), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">0.7</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalizar el layout ajustado</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  layout_normalized <span class="ot">&lt;-</span> <span class="fu">scale</span>(layout_adjusted)</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un dataframe con la información de los nodos</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>  node_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">V</span>(graph)<span class="sc">$</span>name,</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">community =</span> communities<span class="sc">$</span>membership,</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> layout_normalized[,<span class="dv">1</span>],</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> layout_normalized[,<span class="dv">2</span>]</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un dataframe con la información de las aristas</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>  edge_data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">get.edgelist</span>(graph)) <span class="sc">%&gt;%</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">from =</span> V1, <span class="at">to =</span> V2) <span class="sc">%&gt;%</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(node_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(node_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"name"</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_from"</span>, <span class="st">"_to"</span>))</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Definir los colores específicos para las comunidades</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>  color_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#087e8b"</span>, <span class="st">"#ff5a5f"</span>, <span class="st">"#3c3c3c"</span>)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignar colores a las comunidades, repitiendo si es necesario</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>  num_communities <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(communities<span class="sc">$</span>membership))</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>  community_colors <span class="ot">&lt;-</span> <span class="fu">rep_len</span>(color_palette, num_communities)</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el gráfico con ggplot2</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dibujar las aristas como segmentos grises semi-transparentes</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> edge_data, </span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> x_from, <span class="at">y =</span> y_from, <span class="at">xend =</span> x_to, <span class="at">yend =</span> y_to),</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dibujar los nodos como puntos coloreados por comunidad</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> node_data, </span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">factor</span>(community)), </span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir etiquetas de texto repelentes para los nombres de los países</span></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> node_data, </span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> name, <span class="at">color =</span> <span class="fu">factor</span>(community)), </span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">3</span>, <span class="at">max.overlaps =</span> <span class="dv">20</span>, </span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>              <span class="at">segment.color =</span> <span class="st">"gray50"</span>, <span class="at">segment.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aplicar la paleta de colores personalizada</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> community_colors) <span class="sc">+</span></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Usar un tema vacío para el fondo</span></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mantener la proporción de los ejes</span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir título al gráfico</span></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Comunidades comerciales en"</span>, year),</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Comunidad"</span>) <span class="sc">+</span></span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ocultar la leyenda</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráficos para cada año de interés</span></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>plot_1900 <span class="ot">&lt;-</span> <span class="fu">plot_community_optimized</span>(<span class="dv">1900</span>)</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>plot_1955 <span class="ot">&lt;-</span> <span class="fu">plot_community_optimized</span>(<span class="dv">1955</span>)</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>plot_2009 <span class="ot">&lt;-</span> <span class="fu">plot_community_optimized</span>(<span class="dv">2009</span>)</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar los gráficos</span></span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_1900)</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_1955)</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_2009)</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>