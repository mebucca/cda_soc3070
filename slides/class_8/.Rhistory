# load data on extra-marital affairs from package "Ecdat"
library("Ecdat")
library("viridis")
library("modelr")
data(Fair)
affairsdata <- Fair %>% as_tibble()
library("tidyverse")
# load data on extra-marital affairs from package "Ecdat"
library("Ecdat")
library("viridis")
library("modelr")
data(Fair)
affairsdata <- Fair %>% as_tibble()
# create a binary variable indicating wether persons has ever had an affair
affairsdata <- affairsdata %>%
mutate(everaffair = case_when(nbaffairs == 0 ~ "Never", nbaffairs > 0 ~ "At least once") ) %>%
# map into 0/1 code
mutate(everaffair_d = case_when(nbaffairs == 0 ~ 0, nbaffairs > 0 ~ 1))
# display the data as a tibble
affairsdata %>% arrange(age) %>% select(-occupation) %>% tail(15)
logit_affairs_rate <- glm(everaffair_d ~ rate, family=binomial(link="logit"), data=affairsdata); summary(logit_affairs_rate)
p_mu <- affairsdata %>% with(mean(everaffair_d,na.rm=TRUE))
b0 <- logit_affairs_rate$coefficients[1]
b1 <- logit_affairs_rate$coefficients[2]
# plot the result
grid <- affairsdata  %>%data_grid(rate,.model=logit_affairs_rate)
predictions <- cbind(grid,logit_hat = predict(logit_affairs_rate, newdata = grid)) %>%
mutate(p_hat= 1/(1 + exp(-logit_hat)))
affairsdata %>% ggplot(aes(x=rate, y=everaffair_d, group=1, colour=1)) +
stat_function(fun = function(.x) b0 + b1*.x, alpha = 0.5, size=1.5) +
geom_hline(yintercept = b0 + b1*1, linetype="dotted", color = "blue", alpha=0.5, size=1.5) +
geom_hline(yintercept = b0 + b1*5, linetype="dotted", color = "blue", alpha=0.5, size=1.5) +
geom_line(data=predictions, aes(x=rate, y=logit_hat, group=3, colour=3), size=2, alpha = 1) +
xlim(-6,12) +
scale_color_viridis() +  scale_fill_viridis() +
guides(fill=FALSE, color=FALSE) +
theme(axis.text.y = element_text(size = 22), axis.text.x = element_text(size = 22),
axis.title.y = element_text(size = 24), axis.title.x = element_text(size = 24),
legend.text = element_text(size = 18), legend.position="none") +
labs(x="rate marriage", y="logit(Affair)") +
annotate('text', x = 3.7, y = 0.8, label = "beta[1]==-0.51", parse = TRUE, size=8)
ll <- function(b0,b1) {
y = affairsdata$everaffair_d
eta = b0 + b1*affairsdata$rate
ell = sum( y*log(1/(1 + exp(-eta))) +  (1-y)*log(1 - (1/(1 + exp(-eta)))))
return(ll = ell)
}
expand.grid(beta0 = seq(-1,1,length.out=500), beta1 = seq(-1,1,length.out=500))
parameter_space <- expand.grid(beta0 = seq(-1,1,length.out=500), beta1 = seq(-1,1,length.out=500))
parameter_space
parameter_space <- expand.grid(beta0 = seq(-1,1,length.out=500), beta1 = seq(-1,1,length.out=500)) %>%
rowwise() %>% mutate(loglik = ll(beta0,beta1))
parameter_space <- expand.grid(beta0 = seq(-1,1,length.out=500), beta1 = seq(-1,1,length.out=500)) %>%
rowwise() %>% mutate(loglik = ll(beta0,beta1))
parameter_space
m <- parameter_space %>% as.matrix()
m[which.max(m[,3]),]
# Plot all LL values
parameter_space %>% as.data.frame() %>% ggplot(aes(x=beta0, y=beta1,  z = loglik)) + geom_contour(bins = 700) + geom_contour_filled(bins = 500, alpha=0.75) +
geom_point(aes(x=m[which.max(m[,3]),1], m[which.max(m[,3]),2]), size=1.5) +
guides(fill=FALSE, color=FALSE) + labs(x=quote(beta[0]), y=quote(beta[1])) +
annotate(geom="text", x=0.56, y=-0.63, label='bold("(0.83,-0.51)")', color="black", parse=TRUE, size=6)  +
theme(axis.text.y = element_text(size = 22), axis.text.x = element_text(size = 22),
axis.title.y = element_text(size = 24), axis.title.x = element_text(size = 24),
legend.text = element_text(size = 18), legend.position="none")
